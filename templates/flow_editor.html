<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/flow.css') }}?v=9">
</head>
<body>
    <div id="app">
        <div class="sidebar">
            <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –±–æ—Ç–æ–≤</h3>
            
            <div class="sidebar-section">
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞</h4>
                <select id="botSelect">
                    <option value="new">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞...</option>
                </select>
            </div>
            
            <div class="sidebar-section">
                <h4>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h4>
                <button class="btn btn-add" onclick="window.addElement()">+ –°–æ–æ–±—â–µ–Ω–∏–µ</button>
                <button class="btn btn-add" onclick="window.addApiNode()">üåê API –ó–∞–ø—Ä–æ—Å</button>
                <button class="btn btn-add" onclick="window.addConditionNode()">üîÄ –£—Å–ª–æ–≤–∏–µ</button>
                <button class="btn btn-add" onclick="window.addTransformNode()">‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</button>
                <button class="btn btn-action" onclick="window.saveFlow()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-action" onclick="window.exportFlow()">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="btn btn-action" onclick="window.importFlow()">üì• –ò–º–ø–æ—Ä—Ç</button>
            </div>

            <div class="sidebar-section">
                <h4>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</h4>
                <button class="btn btn-mode active" id="modeEdit" onclick="setMode('edit')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                <button class="btn btn-mode" id="modeConnect" onclick="setMode('connect')">üîó –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π</button>
                <button class="btn btn-action" id="btnDeleteConnection" onclick="deleteSelectedConnection()" style="display: none; margin-top: 10px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é —Å–≤—è–∑—å</button>
                <div class="help-box" style="margin-top: 10px;">
                    <div class="help-box-title">–£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π:</div>
                    <div>‚Ä¢ –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å–≤—è–∑—å –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è</div>
                    <div>‚Ä¢ –ù–∞–∂–º–∏—Ç–µ <b>Delete</b> –∏–ª–∏ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ</div>
                    <div>‚Ä¢ –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ <b>√ó</b> –Ω–∞ —Å–≤—è–∑–∏</div>
                    <div>‚Ä¢ –ò–ª–∏ –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ —Å–≤—è–∑—å</div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h4>–°–≤–æ–π—Å—Ç–≤–∞ —É–∑–ª–∞</h4>
                <div id="nodeProperties">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div id="flowCanvas">
                <svg id="connections"></svg>
                <div id="nodes"></div>
            </div>
            <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–æ–º -->
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()" title="–£–≤–µ–ª–∏—á–∏—Ç—å">‚ûï</button>
                <span class="zoom-level" id="zoomLevel">100%</span>
                <button class="zoom-btn" onclick="zoomOut()" title="–£–º–µ–Ω—å—à–∏—Ç—å">‚ûñ</button>
                <button class="zoom-btn" onclick="zoomReset()" title="–°–±—Ä–æ—Å–∏—Ç—å">‚Ü∫</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Markdown —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
    <div id="markdownEditorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù –†–µ–¥–∞–∫—Ç–æ—Ä Markdown</h3>
                <button class="modal-close" onclick="closeMarkdownEditor()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ Markdown -->
                <div class="editor-toolbar" id="markdownToolbar">
                    <button class="toolbar-btn" onclick="insertMarkdown('bold')" title="–ñ–∏—Ä–Ω—ã–π"><b>B</b></button>
                    <button class="toolbar-btn" onclick="insertMarkdown('italic')" title="–ö—É—Ä—Å–∏–≤"><i>I</i></button>
                    <button class="toolbar-btn" onclick="insertMarkdown('strikethrough')" title="–ó–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π"><s>S</s></button>
                    <div class="toolbar-divider"></div>
                    <button class="toolbar-btn" onclick="insertMarkdown('code')" title="–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π">&lt;/&gt;</button>
                    <button class="toolbar-btn" onclick="insertMarkdown('link')" title="–°—Å—ã–ª–∫–∞">üîó</button>
                    <div class="toolbar-divider"></div>
                    <button class="toolbar-btn" onclick="insertMarkdown('ul')" title="–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">‚Ä¢</button>
                    <button class="toolbar-btn" onclick="insertMarkdown('ol')" title="–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">1.</button>
                </div>
                
                <!-- –†–µ–¥–∞–∫—Ç–æ—Ä Markdown -->
                <textarea id="markdownEditorContent" class="editor-code" placeholder="–í–≤–µ–¥–∏—Ç–µ Markdown –∑–¥–µ—Å—å..." maxlength="4000"></textarea>
                
                <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
                <div class="markdown-preview-wrapper">
                    <div class="preview-header">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</div>
                    <div id="markdownPreview" class="markdown-preview"></div>
                </div>
                
                <!-- –°–ø—Ä–∞–≤–∫–∞ –ø–æ Markdown -->
                <div class="markdown-help">
                    <details>
                        <summary>üìñ –°–ø—Ä–∞–≤–∫–∞ –ø–æ Markdown</summary>
                        <div class="help-content">
                            <p><b>–ñ–∏—Ä–Ω—ã–π:</b> <code>**—Ç–µ–∫—Å—Ç**</code> –∏–ª–∏ <code>__—Ç–µ–∫—Å—Ç__</code></p>
                            <p><i>–ö—É—Ä—Å–∏–≤:</i> <code>*—Ç–µ–∫—Å—Ç*</code> –∏–ª–∏ <code>_—Ç–µ–∫—Å—Ç_</code></p>
                            <p><s>–ó–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π:</s> <code>~~—Ç–µ–∫—Å—Ç~~</code></p>
                            <p><code>–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π:</code> <code>`–∫–æ–¥`</code></p>
                            <p>üîó –°—Å—ã–ª–∫–∞: <code>[—Ç–µ–∫—Å—Ç](URL)</code></p>
                            <p>@—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ: <code>"text": "[–ò–º—è –§–∞–º–∏–ª–∏—è](max://user/user_id)"</code></p>
                        </div>
                    </details>
                </div>
                
                <!-- –°—á—ë—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ -->
                <div class="editor-char-counter">
                    <span id="charCount">0</span> / 4000 —Å–∏–º–≤–æ–ª–æ–≤
                    <span id="charLimitWarning" class="char-warning" style="display: none;">‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç!</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-action" onclick="saveMarkdownEditor()">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-mode" onclick="closeMarkdownEditor()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Å–≤—è–∑–µ–π -->
    <div id="connectionContextMenu" class="context-menu" style="display: none;">
        <div class="context-menu-item" onclick="deleteSelectedConnection()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å–≤—è–∑—å</div>
        <div class="context-menu-item" onclick="addControlPoint()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–ø–æ—Ä–Ω—É—é —Ç–æ—á–∫—É</div>
    </div>

    <script>
        // Set the base URL for API calls
        window.API_BASE_URL = '{{ base_url }}';
    </script>
    <script src="{{ url_for('static', filename='js/flow.js') }}?v=11"></script>
</body>
</html>