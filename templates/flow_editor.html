<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/flow.css') }}">
</head>
<body>
    <div id="app">
        <div class="sidebar">
            <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –±–æ—Ç–æ–≤</h3>
            
            <div class="sidebar-section">
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞</h4>
                <select id="botSelect">
                    <option value="new">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞...</option>
                </select>
            </div>
            
            <div class="sidebar-section">
                <h4>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h4>
                <button class="btn btn-add" onclick="window.addElement()">+ –°–æ–æ–±—â–µ–Ω–∏–µ</button>
                <button class="btn btn-add" onclick="window.addApiNode()">üåê API –ó–∞–ø—Ä–æ—Å</button>
                <button class="btn btn-add" onclick="window.addConditionNode()">üîÄ –£—Å–ª–æ–≤–∏–µ</button>
                <button class="btn btn-add" onclick="window.addTransformNode()">‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</button>
                <button class="btn btn-action" onclick="window.saveFlow()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-action" onclick="window.exportFlow()">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="btn btn-action" onclick="window.importFlow()">üì• –ò–º–ø–æ—Ä—Ç</button>
            </div>

            <div class="sidebar-section">
                <h4>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</h4>
                <button class="btn btn-mode active" id="modeEdit" onclick="setMode('edit')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                <button class="btn btn-mode" id="modeConnect" onclick="setMode('connect')">üîó –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π</button>
            </div>
            
            <div class="sidebar-section">
                <h4>–°–≤–æ–π—Å—Ç–≤–∞ —É–∑–ª–∞</h4>
                <div id="nodeProperties">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div id="flowCanvas">
                <svg id="connections"></svg>
                <div id="nodes"></div>
            </div>
            <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–æ–º -->
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()" title="–£–≤–µ–ª–∏—á–∏—Ç—å">‚ûï</button>
                <span class="zoom-level" id="zoomLevel">100%</span>
                <button class="zoom-btn" onclick="zoomOut()" title="–£–º–µ–Ω—å—à–∏—Ç—å">‚ûñ</button>
                <button class="zoom-btn" onclick="zoomReset()" title="–°–±—Ä–æ—Å–∏—Ç—å">‚Ü∫</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ HTML —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
    <div id="htmlEditorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù –†–µ–¥–∞–∫—Ç–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞</h3>
                <button class="modal-close" onclick="closeHtmlEditor()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <div class="editor-mode-toggle">
                    <button class="mode-toggle-btn active" id="wysiwygModeBtn" onclick="setEditorMode('wysiwyg')">
                        üìù –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
                    </button>
                    <button class="mode-toggle-btn" id="htmlModeBtn" onclick="setEditorMode('html')">
                        &lt;/&gt; HTML –∫–æ–¥
                    </button>
                </div>
                
                <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞) -->
                <div class="editor-toolbar" id="editorToolbar">
                    <button class="toolbar-btn" onclick="formatText('bold')" title="–ñ–∏—Ä–Ω—ã–π"><b>B</b></button>
                    <button class="toolbar-btn" onclick="formatText('italic')" title="–ö—É—Ä—Å–∏–≤"><i>I</i></button>
                    <button class="toolbar-btn" onclick="formatText('underline')" title="–ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π"><u>U</u></button>
                    <button class="toolbar-btn" onclick="formatText('strikeThrough')" title="–ó–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π"><s>S</s></button>
                    <div class="toolbar-divider"></div>
                    <button class="toolbar-btn" onclick="formatText('justifyLeft')" title="–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é">‚¨ÖÔ∏è</button>
                    <button class="toolbar-btn" onclick="formatText('justifyCenter')" title="–ü–æ —Ü–µ–Ω—Ç—Ä—É">‚¨ÜÔ∏è</button>
                    <button class="toolbar-btn" onclick="formatText('justifyRight')" title="–ü–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é">‚û°Ô∏è</button>
                    <div class="toolbar-divider"></div>
                    <button class="toolbar-btn" onclick="formatText('insertUnorderedList')" title="–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">‚Ä¢</button>
                    <button class="toolbar-btn" onclick="formatText('insertOrderedList')" title="–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">1.</button>
                    <div class="toolbar-divider"></div>
                    <button class="toolbar-btn" onclick="insertLink()" title="–í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É">üîó</button>
                    <button class="toolbar-btn" onclick="insertImage()" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">üñºÔ∏è</button>
                    <button class="toolbar-btn" onclick="insertCode()" title="–í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥">&lt;/&gt;</button>
                </div>
                
                <!-- –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä -->
                <div id="htmlEditorContent" class="editor-content" contenteditable="true" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å..."></div>
                
                <!-- –†–µ–¥–∞–∫—Ç–æ—Ä HTML –∫–æ–¥–∞ -->
                <div id="htmlCodeEditor" class="editor-code-wrapper" style="display: none;">
                    <textarea id="htmlEditorCode" class="editor-code" placeholder="–í–≤–µ–¥–∏—Ç–µ HTML –∫–æ–¥ –∑–¥–µ—Å—å..." maxlength="4000"></textarea>
                </div>
                
                <!-- –°—á—ë—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ -->
                <div class="editor-char-counter">
                    <span id="charCount">0</span> / 4000 —Å–∏–º–≤–æ–ª–æ–≤
                    <span id="charLimitWarning" class="char-warning" style="display: none;">‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç!</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-action" onclick="saveHtmlEditor()">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-mode" onclick="closeHtmlEditor()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        // Set the base URL for API calls
        window.API_BASE_URL = '{{ base_url }}';
    </script>
    <script src="{{ url_for('static', filename='js/flow.js') }}"></script>
</body>
</html>