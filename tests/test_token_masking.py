"""
–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º src –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', 'src'))

from database import add_bot, get_bot, update_bot, delete_bot, get_all_bots

def test_token_masking():
    """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞
    test_token = "test_token_12345678901234567890"
    bot_id = add_bot("Test Bot", test_token, "https://platform-api.max.ru")
    
    print(f"‚úì –°–æ–∑–¥–∞–Ω –±–æ—Ç —Å ID: {bot_id}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
    bot = get_bot(bot_id)
    assert bot is not None, "–ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"
    assert bot['token'] == test_token, f"–¢–æ–∫–µ–Ω –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç: {bot['token']} != {test_token}"
    print(f"‚úì –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é: {bot['token']}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–∫–µ–Ω –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å
    new_token = "new_token_09876543210987654321"
    update_bot(bot_id, token=new_token)
    
    bot = get_bot(bot_id)
    assert bot['token'] == new_token, f"–¢–æ–∫–µ–Ω –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω: {bot['token']} != {new_token}"
    print(f"‚úì –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω: {bot['token']}")
    
    # –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞
    delete_bot(bot_id)
    print("‚úì –¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç —É–¥–∞–ª–µ–Ω")
    
    print("\n‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
    print("\nüìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ (–≤ –±—Ä–∞—É–∑–µ—Ä–µ).")
    print("   –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞ —Ç–æ–∫–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –≤–∏–¥–µ: 'test_tok‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'")
    print("   –ü–æ–ª–Ω—ã–π —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ data-–∞—Ç—Ä–∏–±—É—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.")

if __name__ == '__main__':
    test_token_masking()
